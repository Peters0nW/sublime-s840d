// SYNTAX TEST "Packages/s840d/s840d.sublime-syntax"

////////////////////////////////////////////////////
// SYNCHRON ACTION tests
// Performance: 1.1ms
////////////////////////////////////////////////////

; simplest example
N1 DO G0 F=$MN_USER_DATA_HEX[12 + R1] X10 Y20
// ^ keyword.control.async.operation
//    ^ support.function.iso
//       ^ support.variable.iso
//        ^ keyword.operator.assignment
//         ^^^ support.variable.machdata
//                                    ^ support.variable.iso
//                                     ^^ constant.language.numeric.iso
//                                        ^ support.variable.iso
//                                         ^^ constant.language.numeric.iso

; constant condition
N2 WHEN TRUE DO M5=10
// ^ keyword.control.async.condition
//      ^ constant.language.boolean
//           ^ keyword.control.async.operation
//              ^ support.function.iso
//                ^ keyword.operator.assignment
//                 ^ constant.language.numeric

; variable condition
N3 WHEN _VAR DO M5=10
// ^ keyword.control.async.condition
//      ^ variable.other
//           ^ keyword.control.async.operation
//              ^ support.function.iso
//                ^ keyword.operator.assignment
//                 ^ constant.language.numeric
N4 WHEN _VAR==TRUE DO M5=10
// ^ keyword.control.async.condition
//      ^ variable.other
//                 ^ keyword.control.async.operation
//                    ^ support.function.iso
//                      ^ keyword.operator.assignment
//                       ^ constant.language.numeric

; condition expression and operation statement
N5 WHENEVER ABS(R1)==10 DO M5=SQRT(-R2)*$PI
// ^ keyword.control.async.condition
//          ^ support.function
//              ^ support.variable.r
//                 ^ keyword.operator.relational
//                   ^ constant.language.numeric
//                      ^ keyword.control.async.operation
//                         ^ support.function.iso
//                           ^ keyword.operator.assignment
//                            ^ support.function

; modal asynchronous positioning call
N6 ID=1 EVERY $A_DBB[5]<>0 DO POS[Q1]=$A_DBB[5]
// ^ keyword.control.async.identifier
//   ^ keyword.operator.assignment
//    ^ constant.language.numeric
//      ^ keyword.control.async.condition
//            ^ support.variable.nck
//                     ^ keyword.operator.relational
//                       ^ constant.language.numeric
//                         ^ keyword.control.async.operation
//                            ^ support.variable.iso
//                                   ^ keyword.operator.assignment

; modal asynchronous function without condition
N7 IDS=1 DO POS[Q1]=($A_DBB[5]+10/$PI)
// ^ keyword.control.async.identifier
//    ^ keyword.operator.assignment
//     ^ constant.language.numeric
//       ^ keyword.control.async.operation
//          ^ support.variable.iso
//                 ^ keyword.operator.assignment

; no assignments in condition allowed
N8 IDS==1 WHENEVER ABS(R1)=10 DO M5=SQRT(2)*$PI
// ^ keyword.control.async.identifier
//    ^ invalid.illegal
//     ^ keyword.operator.assignment
//      ^ constant.language.numeric
//        ^ keyword.control.async.condition
//                 ^ support.function
//                        ^ invalid.illegal
//                            ^ keyword.control.async.operation
//                               ^ support.function.iso
//                                 ^ keyword.operator.assignment
//                                  ^ support.function

; do some tests to ensure editing is not disturbed by
; unassassary invalid.illegal
N9 IDS
// ^ keyword.control.async.identifier
N10 IDS=
//  ^ keyword.control.async.identifier
//     ^ keyword.operator.assignment
N11 IDS=
//  ^ keyword.control.async.identifier
//     ^ keyword.operator.assignment
N12 IDS=10
//  ^ keyword.control.async.identifier
//     ^ keyword.operator.assignment
//      ^ constant.language.numeric
N13 IDS=10 DO
//  ^ keyword.control.async.identifier
//     ^ keyword.operator.assignment
//      ^ constant.language.numeric
//         ^ keyword.control.async.operation
N14 IDS=10 WHENEVER DO
//  ^ keyword.control.async.identifier
//     ^ keyword.operator.assignment
//      ^ constant.language.numeric
//         ^ keyword.control.async.condition
//                  ^ keyword.control.async.operation
